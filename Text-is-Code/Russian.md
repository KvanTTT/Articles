# Текст - это код

Концепция по написанию статей с использованием Git и Markdown.

Плюсы:

* Можно писать текст в любом любимом редакторе, а не только на хабре
  (VSCode, typora, GitHub web)
* Полноценная система контроля версий с историей, мержами, рибейзами, blame и другими
  привычными для программиста фичами
* Также можно юзать возможности GitHub, GitLab (пулл-риквесты, issue, CI)
* Код статьи хранится в репозитории - его всегда можно быстро забекапить.
  Так что не страшна потеря акка на хабре или случайное затирание информации.
  Это касается даже картинок (о том, как сделать маппинг, написано ниже).

Минусы:

* Необходимо всегда коммитить и перегонять в формате Habr (т.к. API, к сожалению, нет)

## Насколько Markdown коррелирует с исходником?

* Есть комментарии

## Как по максимому автоматизировать?

Использовать инструмент MarkConv, который перегоняет Markdown от GitHub в Habr,
т.к. они различаются.

### Редактор VSCode

Как по максимому облегчить и автоматизировать работу?

* Code Spell Checker (для английских статей можно даже grammarly)
* markdownlint - линтер markdown исходников
* Table of Content генератор
* Форматтер таблиц

### Typora - для тех, кто любит Word

Приятный WYSIWYG интерфейс.

## Предлагаемая структура репозитория

<!-- Скопировать из https://habr.com/ru/post/331798/ -->

---

# Как работает MarkConv

## Почему не HTML?

Плюсы:

* Обработка HTML без возни с Markdown
* Можно пользоваться сторонними утилитами конвертации типа pandoc.

Минусы:

* Не все сервисы его поддерживают: Habr - да, Dev.to - нет
* Неправильная обработка блоков кода и других
* Генерируемый из md код слишком большой
* Лучше связь с исходником - в итоговом md проще при необходимости что-то отредактировать

## Техническая реализация

### Почему .NET?

Проект был начат в 2017, хотел быстрее его зарелизить и написать о нем. В .NET
разбирался и разбираюсь лучше всего.

### Первый способ - регулярки и построчная обработка

* Быстрая реализация
* Некорректная обработка некоторых конструкций
* Сложность поддержки сильно растет с добавлением фич
* Не тру

### Полноценный парсинг Markdown и HTML в деревья

* Реализация сложнее и дольше  - парсер и конветртер отдельно.
* Для Markdown - используем парсер Markdig. Из недостатков - не парсит в full fidelity
  дерево, но это не так важно.

### HtmlAgilityPack для HTML блоков

* Чтобы правильно парсить смесь фрагментов, необходимо сначала их перегонять в
  строку, использовать `markdown_block` для Markdown, затем парсить и перегонять
  обратно - костыль.

### ANTLR парсер для HTML блоков

* Необходимо написать собственный лексер и парсер ANTLR (несложно)
* Правильный парсинг смеси фрагментов Markdown и HTML без всяких костылей с `markdown_block`
  Markdown блок просто как отдельный токен.

## Планы:

* Портировать .NET версию на TypeScript для плагина VSCode. Также на такой версии
  можно реализовать конвертер на статичном сайте.
